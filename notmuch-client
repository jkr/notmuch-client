#!/usr/bin/env python
# -*- python -*-

from nmclient import NotmuchCommand, NotmuchClientConfig, CONFIG_LOCATION
from ConfigParser import MissingSectionHeaderError
import sys
import os

if __name__ == "__main__":
    if os.path.isfile(CONFIG_LOCATION):
        try:
            nmconfig = NotmuchClientConfig(CONFIG_LOCATION)
        except MissingSectionHeaderError:
               sys.stderr.write("Couldn't read config file at %s\n. Aborting" % 
                                CONFIG_LOCATION)
               sys.exit(1)
    else:
        nmconfig = NotmuchClientConfig()
        
    if nmconfig.remote:
        try:
            if not os.path.isdir(nmconfig.cache):
                os.mkdir(nmconfig.cache)
        except OSError:
            sys.stdout.write("Can't make cache file at %s" % nmconfig.cache)
    args = sys.argv[1:]
    command = NotmuchCommand.make_command(nmconfig, args)
    output = command.run()
    sys.stdout.write(output[0])
    sys.stderr.write(output[1])
